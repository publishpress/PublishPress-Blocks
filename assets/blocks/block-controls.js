/*! For license information please see block-controls.js.LICENSE.txt */
(()=>{var e={45:e=>{"use strict";e.exports={to12Hour:function(e){var t=e<12?"am":"pm";return{hour:(e+11)%12+1,meridiem:t,meridian:t}},to24Hour:function(e){return("am"===(e.meridiem||e.meridian)?0:12)+e.hour%12}}},942:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function a(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=l(e,o(n)))}return e}function o(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return a.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=l(t,n));return t}function l(e,t){return t?e?e+" "+t:e+t:e}e.exports?(a.default=a,e.exports=a):void 0===(n=function(){return a}.apply(t,[]))||(e.exports=n)}()}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(942),t=n.n(e),r=n(45),a=n.n(r);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function c(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}function i(e,t,n){return t=u(t),function(e,t){if(t&&("object"==o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,s()?Reflect.construct(t,n||[],u(e).constructor):t.apply(e,n))}function s(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(s=function(){return!!e})()}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function m(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||v(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,l,c=[],i=!0,s=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=o.call(n)).done)&&(c.push(r.value),c.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{if(!i&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(s)throw a}}return c}}(e,t)||v(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){if(e){if("string"==typeof e)return b(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var h=wp.components,p=h.ButtonGroup,f=h.Button,y=h.DateTimePicker,k=(h.TextControl,h.CheckboxControl),_=h.Popover,C=h.Tooltip,x=h.SelectControl,w=h.Icon,E=wp.element,T=E.Component,R=E.Fragment,S=E.useState,O=wp.i18n,B=O.__,j=O._x,P=wp.hooks.applyFilters;function A(e){var t=g(S(!1),2),n=t[0],r=t[1],a=function(){r(!n)},o=e.buttonLabel,l=e.dateLabel,c=e.date,i=e.onChangeDate,s=e.onDateClear,u=e.onInvalidDate,d=e.placement,m=e.offset;return React.createElement(R,null,React.createElement("div",{className:"advgb-advcalendar-control"},React.createElement("label",null,l),React.createElement("div",null,React.createElement(f,{isLink:!0,icon:"calendar",onClick:a},React.createElement(C,{text:B("Change date","advanced-gutenberg")},React.createElement("span",null,c?moment(c).format("MMMM DD YYYY, h:mm a"):o))),c&&React.createElement(f,{icon:"no-alt",className:"advgb-advcalendar-remove-icon",onClick:function(){return s()}}))),n&&React.createElement(_,{className:"advgb-advcalendar-popover",onClose:r.bind(null,!1),resize:!1,placement:d,offset:m},React.createElement("label",{className:"advgb-advcalendar-popover-label"},l,React.createElement(f,{icon:"no-alt",className:"advgb-advcalendar-remove-icon",onClick:a})),React.createElement(y,{currentDate:c,onChange:i,is12Hour:!0,isInvalidDate:u})))}function F(e){var t=[{slug:0,label:j("S","Sunday first letter","advanced-gutenberg")},{slug:1,label:B("M","advanced-gutenberg")},{slug:2,label:j("T","Tuesday first letter","advanced-gutenberg")},{slug:3,label:B("W","advanced-gutenberg")},{slug:4,label:j("T","Thursday first letter","advanced-gutenberg")},{slug:5,label:B("F","advanced-gutenberg")},{slug:6,label:j("S","Saturday first letter","advanced-gutenberg")}],n=e.label,r=e.days,a=e.onChangeDays,o=g(S(r),2),l=o[0],c=o[1];function i(e){return l.some((function(t){return t===e}))}return React.createElement(R,null,React.createElement("div",{className:"advgb-checkbox-wrapper"},React.createElement("label",null,n),React.createElement("div",{className:"advgb-checkbox-inline"},t.map((function(e){return React.createElement(k,{label:e.label,checked:i(e.slug),onChange:function(){return function(e){var n;if(i(e))n=l.filter((function(t){return t!==e}));else{var r=t.find((function(t){return t.slug===e}));n=[].concat(m(l),[r.slug])}var o=m(new Set(n));c(o),a&&a(n)}(e.slug)}})})))))}A.defaultProps={placement:"left",offset:40};var D=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=i(this,t,[e])).state={onChangeTime:null,currentTime:n.props.currentTime||null,hours:null,minutes:null,meridian:"am",onInit:!0},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(t,e),n=t,(r=[{key:"componentWillMount",value:function(){var e=this.state,t=e.onChangeTime,n=e.currentTime,r=e.onInit;this.props.onChangeTime!==t&&this.setState({onChangeTime:this.props.onChangeTime}),this.props.currentTime!==n&&this.setState({currentTime:this.props.currentTime}),n&&n.includes(":")&&r&&this.setState({hours:n.split(":")[0],minutes:n.split(":")[1],meridian:parseInt(n.split(":")[0])>11?"pm":"am",onInit:!1})}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,r=(n.onChangeTime,n.currentTime,this.state),o=r.hours,l=r.minutes,c=r.meridian,i=t.hours,s=t.minutes,u=t.meridian;if(o!==i||l!==s||c!==u){if(!o&&!l)return;o&&!l&&this.setState({minutes:"00"}),l&&!o&&this.setState({hours:"01"});var d="".concat(this.appendZero(a().to24Hour({hour:parseInt(o),meridiem:c})),":").concat(l,":00");this.props.onChangeTime(d)}}},{key:"appendZero",value:function(e){if(!isNaN(e)){var t=parseInt(e);return t>9?t:"0".concat(t)}}},{key:"render",value:function(){var e=this,t=this.state,n=(t.onChangeTime,t.currentTime,t.hours),r=t.minutes,o=t.meridian;return React.createElement(R,null,React.createElement("div",{className:"advgb-advtime-control"},React.createElement("label",null,this.props.label),React.createElement("div",{className:"advgb-advtime-hours-minutes"},React.createElement("input",{type:"text",value:n?this.appendZero(a().to12Hour(parseInt(n)).hour):"",onChange:function(t){var n=Math.max(1,Math.min(12,Number(t.target.value)));e.setState({hours:e.appendZero(n)})},onKeyDown:function(t){var n=Number(t.target.value);"ArrowUp"===t.key&&n<12?e.setState({hours:e.appendZero(n+1)}):"ArrowDown"===t.key&&n>1&&e.setState({hours:e.appendZero(n-1)})},placeholder:"--"}),React.createElement("span",null,":"),React.createElement("input",{type:"text",value:r||"",onChange:function(t){var n=Math.max(0,Math.min(59,Number(t.target.value)));e.setState({minutes:e.appendZero(n)})},onKeyDown:function(t){var n=Number(t.target.value);"ArrowUp"===t.key&&n<59?e.setState({minutes:e.appendZero(n+1)}):"ArrowDown"===t.key&&n>0&&e.setState({minutes:e.appendZero(n-1)})},placeholder:"--"})),React.createElement(p,{className:"advgb-advtime-meridian"},React.createElement(f,{variant:null===o||"am"===o?"primary":"secondary",onClick:function(){e.setState({meridian:"am"})},disabled:!n||!r},B("AM","advanced-gutenberg")),React.createElement(f,{variant:"pm"===o?"primary":"secondary",onClick:function(){e.setState({meridian:"pm"})},disabled:!n||!r},B("PM","advanced-gutenberg"))),n&&r&&React.createElement(f,{className:"advgb-advtime-remove-icon",icon:"no-alt",onClick:function(){e.props.onTimeClear(),e.setState({hours:null,minutes:null,meridian:"am"})}})))}}])&&l(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(T);function I(e){var t=e.label,n=e.currentTime,r=e.onChangeTime,a=e.onTimeClear;return React.createElement(D,{label:t,currentTime:n,onChangeTime:r,onTimeClear:a})}function z(e){var t=e.label,n=e.defaultTimezone;return React.createElement(R,null,P("advgb.timezoneControl",React.createElement(R,null,React.createElement("div",{style:{marginTop:10,marginBottom:30}},React.createElement("div",{style:{marginBottom:6}},t,React.createElement("span",{style:{float:"right",marginRight:5}},React.createElement(w,{icon:"lock"}),React.createElement("a",{href:"https://publishpress.com/links/blocks",class:"advgb-pro-ad-btn",target:"_blank"},B("Upgrade to Pro","advanced-gutenberg")))),React.createElement(x,{value:n,options:[{label:n,value:n}],disabled:!0}))),e))}var N=function(e){return e.map((function(e){return e.title}))},M=function(e,t){var n=[];return null!==t&&(n=e.map((function(e){var n=t.find((function(t){return t.slug===e}));return void 0!==n&&n?n.title:e}))),n},K=function(e,t){var n=[];return e.map((function(e){var r=t.find((function(t){return t.title===e}));void 0!==r&&n.push(r.slug)})),n};function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){W(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function W(e,t,n){return(t=Y(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Y(r.key),r)}}function Y(e){var t=function(e){if("object"!=L(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==L(t)?t:t+""}function Q(e,t,n){return t=G(t),function(e,t){if(t&&("object"==L(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,$()?Reflect.construct(t,n||[],G(e).constructor):t.apply(e,n))}function $(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return($=function(){return!!e})()}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},G(e)}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q(e,t)}function J(){return J=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},J.apply(null,arguments)}function V(e){return function(e){if(Array.isArray(e))return X(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return X(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}!function(e,n,r,a,o,l,c){a=wp.blockEditor||wp.editor;var i=n.addFilter,s=e.sprintf,u=e.__,d=r.hasBlockSupport,m=a,g=m.InspectorControls,v=(m.BlockControls,o.DateTimePicker,o.ToggleControl),b=o.PanelBody,h=o.Notice,p=o.FormTokenField,f=o.SelectControl,y=o.TextControl,k=(o.RadioControl,o.Button),_=l.createHigherOrderComponent,C=c.Component,x=c.Fragment;if(parseInt(advgbBlocks.block_controls)){var w=["core/freeform","core/legacy-widget","core/widget-area","core/column","advgb/tab","advgb/column"],E=function(){return void 0!==advgb_block_controls_vars.controls&&Object.keys(advgb_block_controls_vars.controls).length>0?advgb_block_controls_vars.controls:[]},T=function(e){return e&&(e.hasOwnProperty("dateFrom")||e.hasOwnProperty("dateTo")||e.hasOwnProperty("days")||e.hasOwnProperty("recurring"))},R=function(e){return void 0!==e&&e},S=function(e){var t=E(),n=0,r=[];return Object.keys(t).forEach((function(e){R(advgb_block_controls_vars.controls[e])&&r.push(e)})),r.forEach((function(t){B(e,t,"enabled")&&n++})),n>0},O=function(){var e=E(),t=0;return Object.keys(e).map((function(e){R(advgb_block_controls_vars.controls[e])&&t++})),t>0},B=function(e,t,n){if(void 0!==e&&e.length&&e.some((function(e){return e.control===t}))){var r=e.findIndex((function(e){return e.control===t}));if(r<0)return!1;var a=V(e)[r];return"schedule"===t?T(a)?"schedules"===n?[{dateFrom:a.dateFrom||null,dateTo:a.dateTo||null,recurring:a.recurring||!1,days:a.days||[],timeFrom:a.timeFrom||null,timeTo:a.timeTo||null,timezone:a.timezone||null}]:"enabled"===n?a.enabled||!1:a[n]:"schedules"===n?a.schedules||[]:"enabled"===n?a.enabled||!1:a.schedules&&a.schedules.length>0?a.schedules[0][n]:null:a[n]}return null},j=function(e){var t=e.index,n=e.schedule,r=e.onChange,a=e.onRemove,o=e.getTimezoneLabel,l=e.getTimezoneSlug,c=e.canRemove;return React.createElement("div",{style:{marginBottom:5,padding:5,border:"1px solid #ddd",borderRadius:4}},React.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16}},React.createElement("h4",null,s(u("Schedule #%d","advanced-gutenberg"),t+1)),c&&React.createElement(k,{isDestructive:!0,isLink:!0,onClick:a},u("Remove","advanced-gutenberg"))),React.createElement(A,{buttonLabel:u("Now","advanced-gutenberg"),dateLabel:u("Start showing","advanced-gutenberg"),date:n.dateFrom,onChangeDate:function(e){return r("dateFrom",e)},onDateClear:function(){return r("dateFrom",null)},onInvalidDate:!1}),React.createElement(A,{buttonLabel:u("Never","advanced-gutenberg"),dateLabel:u("Stop showing","advanced-gutenberg"),date:n.dateTo||null,onChangeDate:function(e){return r("dateTo",e)},onDateClear:function(){return r("dateTo",null)},onInvalidDate:function(e){if(n.dateFrom){var t=new Date(e.getTime());t.setHours(0,0,0,0);var r=new Date(n.dateFrom);return r.setHours(0,0,0,0),t.getTime()<r.getTime()}return!1}}),n.dateFrom&&n.dateTo&&React.createElement(v,{label:u("Recurring","advanced-gutenberg"),checked:n.recurring||!1,onChange:function(){return r("recurring",!n.recurring)},help:u("If Recurring is enabled, this block will be displayed every year between the selected dates.","advanced-gutenberg")}),React.createElement(F,{label:u("On these days (optional)","advanced-gutenberg"),days:n.days||[],onChangeDays:function(e){return r("days",e)}}),React.createElement("label",{style:{marginBottom:8,display:"block"}},u("Between these times (optional)","advanced-gutenberg")),React.createElement(I,{label:u("From","advanced-gutenberg"),currentTime:n.timeFrom||null,onChangeTime:function(e){return r("timeFrom",e)},onTimeClear:function(){return r("timeFrom",null)}}),React.createElement(I,{label:u("To","advanced-gutenberg"),currentTime:n.timeTo||null,onChangeTime:function(e){return r("timeTo",e)},onTimeClear:function(){return r("timeTo",null)}}),n.timeFrom&&n.timeTo&&"01/01/2020T"+n.timeFrom>="01/01/2020T"+n.timeTo&&React.createElement(h,{className:"advgb-notice-sidebar",status:"warning",isDismissible:!1},u('"To" time should be after "From" time!',"advanced-gutenberg")),React.createElement(z,{label:u("Timezone","advanced-gutenberg"),defaultTimezone:o(),value:n.timezone||l(),onChangeTimezone:function(e){return r("timezone",e)}}))};"undefined"!=typeof advgb_block_controls_vars&&void 0!==advgb_block_controls_vars.non_supported&&advgb_block_controls_vars.non_supported.length>0&&(w=[].concat(V(w),V(advgb_block_controls_vars.non_supported)),w=V(new Set(w))),i("blocks.registerBlockType","advgb/blockControls",(function(e){return!w.includes(e.name)&&O()&&(e.attributes=J(e.attributes,{advgbBlockControls:{type:"array",items:{type:"object"},default:[]}})),e}));var P=_((function(e){return function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=Q(this,n,[e])).state={taxModOptions:[],termOptions:[],searchTermWord:"",initArchive:!0,updateTaxLabels:!1},t.isPost=t.isPost.bind(t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}(n,t),r=n,a=[{key:"getTermSlugs",value:function(e){var t=this,n=(this.getTaxonomies(),[]);return e.forEach((function(e){var r=t.getTaxonomies(),a=r.findIndex((function(t){return t.slug===e}));r[a].terms.forEach((function(e){n.push(e.slug)}))})),n}},{key:"getTaxonomies",value:function(){return void 0!==advgb_block_controls_vars.taxonomies&&advgb_block_controls_vars.taxonomies.length>0?advgb_block_controls_vars.taxonomies:[]}},{key:"getUserRoles",value:function(){return void 0!==advgb_block_controls_vars.user_roles&&advgb_block_controls_vars.user_roles.length>0?advgb_block_controls_vars.user_roles:[]}},{key:"getTerms",value:function(e){var t=this,n=(this.getTaxonomies(),[]);return e.forEach((function(e){var r=t.getTaxonomies(),a=r.findIndex((function(t){return t.slug===e}));r[a].terms.forEach((function(e){n.push({slug:e.slug,title:"".concat(e.title," (").concat(r[a].title,")")})}))})),n}},{key:"getPages",value:function(){return void 0!==advgb_block_controls_vars.page&&advgb_block_controls_vars.page.length>0?advgb_block_controls_vars.page:[]}},{key:"changeControlKey",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=this.props,a=r.attributes,o=r.setAttributes,l=a.advgbBlockControls,c={control:"schedule",enabled:!0,schedules:[{dateFrom:null,dateTo:null,recurring:!1,days:[],timeFrom:null,timeTo:null,timezone:this.getTimezoneSlug()}]},i={control:"user_role",enabled:!0,roles:[],approach:"public"},s={control:"archive",enabled:!0,taxonomies:[],approach:"exclude"},u={control:"page",enabled:!0,pages:[],approach:"exclude"},d={control:"device_type",enabled:!0,devices:[]},m={control:"device_width",enabled:!0,min_width:"",max_width:""},g=!(void 0===l||!l.length),v=!(!g||!l.some((function(t){return t.control===e})));if(v){var b=l.findIndex((function(t){return t.control===e}));if(b<0)return!1;var h=V(l),p=h[b];if("schedule"===e){if(T(p)){var f={dateFrom:p.dateFrom||null,dateTo:p.dateTo||null,recurring:p.recurring||!1,days:p.days||[],timeFrom:p.timeFrom||null,timeTo:p.timeTo||null,timezone:p.timezone||this.getTimezoneSlug()};return h[b]={control:"schedule",enabled:p.enabled,schedules:[f]},"enabled"!==t&&"schedules"!==t?h[b].schedules[0][t]=n:h[b][t]=n,void o({advgbBlockControls:h})}if("schedules"===t)h[b]=H(H({},h[b]),{},{schedules:n});else if("enabled"===t)h[b]=H(H({},h[b]),{},{enabled:"boolean"==typeof n?n:!p.enabled});else{var y=V(p.schedules||[]);0===y.length&&y.push({dateFrom:null,dateTo:null,recurring:!1,days:[],timeFrom:null,timeTo:null,timezone:this.getTimezoneSlug()}),y[0][t]=n,h[b]=H(H({},h[b]),{},{schedules:y})}o({advgbBlockControls:h})}else h[b]="boolean"==typeof p[t]?H(H({},h[b]),{},W({},t,!p[t])):H(H({},h[b]),{},W({},t,n));o({advgbBlockControls:h})}else if(g&&!v){var k={};switch(e){case"schedule":k[e]=c;break;case"user_role":o({advgbBlockControls:[].concat(V(l),[i])});break;case"archive":o({advgbBlockControls:[].concat(V(l),[s])});break;case"page":o({advgbBlockControls:[].concat(V(l),[u])});break;case"device_type":o({advgbBlockControls:[].concat(V(l),[d])});break;case"device_width":o({advgbBlockControls:[].concat(V(l),[m])})}k[e]&&o({advgbBlockControls:[].concat(V(l),[k[e]])})}else{var _={};switch(e){case"schedule":_[e]=c;break;case"user_role":o({advgbBlockControls:[i]});break;case"archive":o({advgbBlockControls:[s]});break;case"page":o({advgbBlockControls:[u]});break;case"device_type":o({advgbBlockControls:[d]});break;case"device_width":o({advgbBlockControls:[m]})}_[e]&&o({advgbBlockControls:[_[e]]})}}},{key:"changeArchiveControl",value:function(e,t){var n=this,r=this.props,a=r.attributes,o=r.setAttributes,l=a.advgbBlockControls,c=[],i=l.findIndex((function(e){return"archive"===e.control}));if(i<0)return!1;var s=V(l);if("taxonomies"===e)t.forEach((function(e){var t=s[i].taxonomies.findIndex((function(t){return t.tax===e}));if(-1===t)c.push({tax:e,terms:[],all:!0});else{var n=s[i].taxonomies[t].terms.length?s[i].taxonomies[t].terms:[];n.length,c.push({tax:e,terms:n,all:!n.length})}})),s[i]=H(H({},s[i]),{},W({},"taxonomies",c)),o({advgbBlockControls:s});else if("terms"===e){var u={},d=this.currentArchiveControl("taxonomies");t.forEach((function(e){var t=n.state.termOptions.find((function(t){return t.slug===e}));void 0===u[t.tax]&&(u[t.tax]=[]),s[i].taxonomies.findIndex((function(e){return e.tax===t.tax})),d.includes(t.tax)&&u[t.tax].push(e)})),Object.keys(u).forEach((function(e){var t=s[i].taxonomies.findIndex((function(t){return t.tax===e}));t>=0&&(s[i].taxonomies[t]={tax:e,terms:u[e],all:!u[e].length})})),d.forEach((function(e){if(!Object.keys(u).includes(e)){var t=s[i].taxonomies.findIndex((function(t){return t.tax===e}));t>=0&&(s[i].taxonomies[t]={tax:e,terms:[],all:!0})}})),o({advgbBlockControls:s})}}},{key:"currentArchiveControl",value:function(e){var t=this.props,n=t.attributes,r=(t.setAttributes,n.advgbBlockControls),a=[],o=B(r,"archive","taxonomies").length?B(r,"archive","taxonomies"):[];return"taxonomies"===e?o.forEach((function(e){a.push(e.tax)})):"terms"===e&&o.forEach((function(e){e.terms.forEach((function(e){a.push(e)}))})),a}},{key:"taxonomiesChanged",value:function(){var e=this,t=this.props.attributes.advgbBlockControls,n=B(t,"archive","terms")?B(t,"archive","terms"):[],r=B(t,"archive","taxonomies")?B(t,"archive","taxonomies"):[];if(n.length){var a=[];n.forEach((function(t){var n=e.state.termOptions.findIndex((function(e){return e.slug===t}));r.includes(e.state.termOptions[n].tax)&&a.push(e.state.termOptions[n].slug)})),this.changeControlKey("archive","terms",a)}this.setState({termOptions:this.state.termOptions.filter((function(t){return e.currentArchiveControl("taxonomies").includes(t.tax)}))}),this.modifyTaxLabels()}},{key:"initArchiveControl",value:function(){var e=this;this.props.attributes.advgbBlockControls,wp.apiFetch({path:wp.url.addQueryArgs("advgb/v1/terms",{taxonomies:this.currentArchiveControl("taxonomies"),ids:this.currentArchiveControl("terms")})}).then((function(t){e.modifyTaxLabels(),e.setState({termOptions:t,initArchive:!1,updateTaxLabels:!1})}))}},{key:"iniTaxLabels",value:function(){var e=[];return this.getTaxonomies().forEach((function(t){e.push({slug:t.slug,title:s(u("All %s terms","advanced-gutenberg"),t.title),singular:t.title})})),e}},{key:"modifyTaxLabels",value:function(){var e=this.props.attributes.advgbBlockControls,t=B(e,"archive","taxonomies").length?B(e,"archive","taxonomies"):[],n=V(this.state.taxModOptions);n.forEach((function(e,r){var a=t.find((function(t){return e.slug===t.tax})),o=H({},n[r]);o.title=s(void 0!==a&&a.terms.length?u("Selected %s terms","advanced-gutenberg"):u("All %s terms","advanced-gutenberg"),o.singular),n[r]=o})),this.setState({taxModOptions:n,updateTaxLabels:!1})}},{key:"searchTerms",value:function(){var e=this,t=this.state,n=t.termOptions,r=t.searchTermWord;this.props.attributes.advgbBlockControls,wp.apiFetch({path:wp.url.addQueryArgs("advgb/v1/terms",{search:r,taxonomies:this.currentArchiveControl("taxonomies")})}).then((function(t){var r=[].concat(V(n),V(t));r=Array.from(new Set(r.map((function(e){return e.slug})))).map((function(e){return r.find((function(t){return t.slug===e}))})),e.setState({termOptions:r})}))}},{key:"isPost",value:function(){return wp.data.select("core/editor")&&wp.data.select("core/editor").getCurrentPostId()}},{key:"getTimezoneLabel",value:function(){return void 0!==advgbBlocks.timezone&&advgbBlocks.timezone.length?advgbBlocks.timezone.replace(/_/g," "):u("WordPress settings timezone","advanced-gutenberg")}},{key:"getTimezoneSlug",value:function(){return void 0!==advgbBlocks.timezone&&advgbBlocks.timezone.length?advgbBlocks.timezone:"UTC"}},{key:"componentDidMount",value:function(){this.setState({taxModOptions:this.iniTaxLabels()})}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,r=n.attributes,a=n.isSelected,o=n.name,l=r.advgbBlockControls,c=e.attributes.advgbBlockControls,i=this.state,s=i.searchTermWord,u=i.initArchive,d=t.searchTermWord;!this.isPost()&&!w.includes(o)&&a&&u&&R(advgb_block_controls_vars.controls.archive)&&B(l,"archive","enabled")&&this.currentArchiveControl("taxonomies").length&&this.currentArchiveControl("terms").length&&this.initArchiveControl(),s!==d&&s.length>2&&this.searchTerms(),!this.isPost()&&R(advgb_block_controls_vars.controls.archive)&&B(l,"archive","enabled")&&(B(c,"archive","taxonomies")!==B(l,"archive","taxonomies")||this.state.updateTaxLabels)&&this.taxonomiesChanged()}},{key:"render",value:function(){var t=this,n=this.props,r=n.attributes,a=(n.setAttributes,r.advgbBlockControls);return[this.props.isSelected&&!w.includes(this.props.name)&&O()&&React.createElement(g,{key:"advgb-bc-controls"},React.createElement(b,{title:u("Block Controls","advanced-gutenberg"),icon:"visibility",initialOpen:!1,className:S(a)?"advgb-feature-icon-active":""},R(advgb_block_controls_vars.controls.schedule)&&React.createElement(x,null,React.createElement(v,{label:u("Schedule","advanced-gutenberg"),help:B(a,"schedule","enabled")?u("Choose when to start showing and/or stop showing this block.","advanced-gutenberg"):"",checked:B(a,"schedule","enabled"),onChange:function(){return t.changeControlKey("schedule","enabled")}}),B(a,"schedule","enabled")&&React.createElement(x,null,(B(a,"schedule","schedules")||[]).map((function(e,n){return React.createElement(j,{key:n,index:n,schedule:e,onChange:function(e,r){var o=V(B(a,"schedule","schedules")||[]);o[n][e]=r,t.changeControlKey("schedule","schedules",o)},onRemove:function(){var e=V(B(a,"schedule","schedules")||[]);e.length>1&&(e.splice(n,1),t.changeControlKey("schedule","schedules",e))},getTimezoneLabel:t.getTimezoneLabel,getTimezoneSlug:t.getTimezoneSlug,canRemove:(B(a,"schedule","schedules")||[]).length>1})})),React.createElement("div",{style:{marginBottom:16}},React.createElement(k,{style:{width:"100%",display:"block"},isSecondary:!0,onClick:function(){var e=B(a,"schedule","schedules")||[],n={dateFrom:null,dateTo:null,recurring:!1,days:[],timeFrom:null,timeTo:null,timezone:t.getTimezoneSlug()};t.changeControlKey("schedule","schedules",[].concat(V(e),[n]))}},u("Add Another Schedule","advanced-gutenberg"))))),R(advgb_block_controls_vars.controls.user_role)&&React.createElement(x,null,React.createElement(v,{label:u("User roles","advanced-gutenberg"),help:B(a,"user_role","enabled")?u("Choose which users can see this block.","advanced-gutenberg"):"",checked:B(a,"user_role","enabled"),onChange:function(){return t.changeControlKey("user_role","enabled")}}),B(a,"user_role","enabled")&&React.createElement(x,null,React.createElement("div",{className:"advgb-revert-mb"},React.createElement(f,{value:B(a,"user_role","approach"),options:[{value:"public",label:u("Show to everyone","advanced-gutenberg")},{value:"hidden",label:u("Hide from everyone","advanced-gutenberg")},{value:"login",label:u("Show to logged in users","advanced-gutenberg")},{value:"logout",label:u("Show to logged out users","advanced-gutenberg")},{value:"include",label:u("Show to the selected user roles","advanced-gutenberg")},{value:"exclude",label:u("Hide from the selected user roles","advanced-gutenberg")}],onChange:function(e){return t.changeControlKey("user_role","approach",e)}})),("include"===B(a,"user_role","approach")||"exclude"===B(a,"user_role","approach"))&&React.createElement(x,null,React.createElement(p,{multiple:!0,label:u("Select user roles","advanced-gutenberg"),placeholder:u("Search","advanced-gutenberg"),suggestions:N(this.getUserRoles()),maxSuggestions:10,value:M(B(a,"user_role","roles")?B(a,"user_role","roles"):[],this.getUserRoles()),onChange:function(e){t.changeControlKey("user_role","roles",K(e,t.getUserRoles()))},__experimentalExpandOnFocus:!0}),("include"===B(a,"user_role","approach")||"exclude"===B(a,"user_role","approach"))&&!B(a,"user_role","roles").length&&React.createElement(h,{className:"advgb-notice-sidebar",status:"warning",isDismissible:!1,style:{marginBottom:30}},u("Please select at least one user role.","advanced-gutenberg"))))),R(advgb_block_controls_vars.controls.device_type)&&React.createElement(x,null,React.createElement(v,{label:u("Device Type","advanced-gutenberg"),help:B(a,"device_type","enabled")?u("Choose which devices this block should be visible on.","advanced-gutenberg"):"",checked:B(a,"device_type","enabled"),onChange:function(){return t.changeControlKey("device_type","enabled")}}),B(a,"device_type","enabled")&&React.createElement(x,null,React.createElement(v,{label:u("Desktop","advanced-gutenberg"),checked:B(a,"device_type","devices").includes("desktop"),onChange:function(){var e=B(a,"device_type","devices"),n=e.includes("desktop")?e.filter((function(e){return"desktop"!==e})):[].concat(V(e),["desktop"]);t.changeControlKey("device_type","devices",n)}}),React.createElement(v,{label:u("Tablet","advanced-gutenberg"),checked:B(a,"device_type","devices").includes("tablet"),onChange:function(){var e=B(a,"device_type","devices"),n=e.includes("tablet")?e.filter((function(e){return"tablet"!==e})):[].concat(V(e),["tablet"]);t.changeControlKey("device_type","devices",n)}}),React.createElement(v,{label:u("Mobile","advanced-gutenberg"),checked:B(a,"device_type","devices").includes("mobile"),onChange:function(){var e=B(a,"device_type","devices"),n=e.includes("mobile")?e.filter((function(e){return"mobile"!==e})):[].concat(V(e),["mobile"]);t.changeControlKey("device_type","devices",n)}}))),R(advgb_block_controls_vars.controls.device_width)&&React.createElement(x,null,React.createElement(v,{label:u("Device Width","advanced-gutenberg"),help:B(a,"device_width","enabled")?u("Set minimum and maximum screen widths for this block.","advanced-gutenberg"):"",checked:B(a,"device_width","enabled"),onChange:function(){return t.changeControlKey("device_width","enabled")}}),B(a,"device_width","enabled")&&React.createElement(x,null,React.createElement(y,{type:"number",label:u("Minimum width (px)","advanced-gutenberg"),value:B(a,"device_width","min_width")||"",onChange:function(e){return t.changeControlKey("device_width","min_width",e)},placeholder:u("No minimum","advanced-gutenberg")}),React.createElement(y,{type:"number",label:u("Maximum width (px)","advanced-gutenberg"),value:B(a,"device_width","max_width")||"",onChange:function(e){return t.changeControlKey("device_width","max_width",e)},placeholder:u("No maximum","advanced-gutenberg")}))),!this.isPost()&&React.createElement(x,null,R(advgb_block_controls_vars.controls.archive)&&React.createElement(x,null,React.createElement(v,{label:u("Term archives","advanced-gutenberg"),help:B(a,"archive","enabled")?u("Choose on which taxonomies and terms archive pages your blocks can be displayed.","advanced-gutenberg"):"",checked:B(a,"archive","enabled"),onChange:function(){return t.changeControlKey("archive","enabled")}}),B(a,"archive","enabled")&&React.createElement(x,null,React.createElement("div",{className:"advgb-revert-mb--disabled",style:{marginBottom:20}},React.createElement(f,{value:B(a,"archive","approach"),options:[{value:"include",label:u("Show for selected terms","advanced-gutenberg")},{value:"exclude",label:u("Hide for selected terms","advanced-gutenberg")}],onChange:function(e){return t.changeControlKey("archive","approach",e)}})),React.createElement(p,{multiple:!0,label:u("Select taxonomies","advanced-gutenberg"),placeholder:u("Search taxonomies","advanced-gutenberg"),suggestions:N(this.state.taxModOptions||this.getTaxonomies()),maxSuggestions:10,value:M(this.currentArchiveControl("taxonomies"),this.state.taxModOptions||this.getTaxonomies()),onChange:function(e){t.changeArchiveControl("taxonomies",K(e,t.state.taxModOptions||t.getTaxonomies()))},__experimentalExpandOnFocus:!0}),B(a,"archive","taxonomies").length>0&&React.createElement(x,null,React.createElement(p,{multiple:!0,label:u("Filter terms","advanced-gutenberg"),placeholder:u("Search terms","advanced-gutenberg"),suggestions:N(this.state.termOptions),maxSuggestions:10,value:M(this.currentArchiveControl("terms"),this.state.termOptions),onChange:function(e){t.changeArchiveControl("terms",K(e,t.state.termOptions)),t.setState({updateTaxLabels:!0})},onInputChange:function(e){t.setState({searchTermWord:e})},__experimentalShowHowTo:!1}),React.createElement("div",{className:"advgb-revert-mb--disabled components-form-token-field__help",style:{marginBottom:20}},u("Use this filter to apply only to some terms.","advanced-gutenberg"))))),R(advgb_block_controls_vars.controls.page)&&React.createElement(x,null,React.createElement(v,{label:u("Pages","advanced-gutenberg"),help:B(a,"page","enabled")?u("Choose in which pages this block can be displayed.","advanced-gutenberg"):"",checked:B(a,"page","enabled"),onChange:function(){return t.changeControlKey("page","enabled")}}),B(a,"page","enabled")&&React.createElement(x,null,React.createElement("div",{className:"advgb-revert-mb"},React.createElement(f,{value:B(a,"page","approach"),options:[{value:"include",label:u("Show on the selected pages","advanced-gutenberg")},{value:"exclude",label:u("Hide on the selected pages","advanced-gutenberg")}],onChange:function(e){return t.changeControlKey("page","approach",e)}})),("include"===B(a,"page","approach")||"exclude"===B(a,"page","approach"))&&React.createElement(p,{multiple:!0,label:u("Select pages","advanced-gutenberg"),placeholder:u("Search","advanced-gutenberg"),suggestions:N(this.getPages()),maxSuggestions:10,value:M(B(a,"page","pages")?B(a,"page","pages"):[],this.getPages()),onChange:function(e){t.changeControlKey("page","pages",K(e,t.getPages()))},__experimentalExpandOnFocus:!0})))))),React.createElement(e,J({key:"block-edit-advgb-dates"},this.props))]}}],a&&Z(r.prototype,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,a}(C)}),"withEditControls");i("editor.BlockEdit","advgb/addBlockControls",P),i("editor.BlockListBlock","advgb/loadBackendBlockControls",_((function(e){return function(n){if(!w.includes(n.name)&&d(n.name,"advgb/blockControls",!0)&&O()){var r=n.attributes.advgbBlockControls,a=!1===n.isSelected&&S(r)?"advgb-bc-editor-preview":"";return React.createElement(e,J({},n,{className:t()(n.className,a),advgbBlockControls:"".concat(r)}))}return React.createElement(e,n)}}),"withAttributes"))}}(wp.i18n,wp.hooks,wp.blocks,wp.blockEditor,wp.components,wp.compose,wp.element)})()})();
//# sourceMappingURL=block-controls.js.map